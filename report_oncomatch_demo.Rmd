---
title: "OncoMatch Panel Annotation Demo"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = TRUE, warning = TRUE)

# Source the main engine script

# This will:

# - load required packages

# - load the gene_panel data

# - define annotate_variant(), assign_tier(), etc.

# - run the example and create `annotated` and `example` objects

source("cancer-annotation-mvp.R")
```

### 1. Overview

This report demonstrates the panel-level annotation engine:

-   Loads curated data from gene_panel/

-   Annotates example variants using annotate_variant()

-   Assigns tiers (Tier 1--4) using an OncoMatch-style "What Matters" rule

-   Summarises variants by tier

### 2. Example annotated variants

```{r, echo=FALSE}
library(knitr)
library(kableExtra)
annotated_display <- annotated %>%
select(
gene,
position,
ref,
alt,
mutation_status,
mutation_classification,
afr_frequency,
tier,
tier_explanation
)

annotated_display %>%
kable(
format = "html",
caption = "Annotated Variants – Tiered by Actionability",
col.names = c(
"Gene",
"Position (GRCh38)",
"Ref",
"Alt",
"Mutation status",
"Clinical classification",
"AFR frequency",
"Tier",
"Tier explanation"
),
escape = TRUE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = FALSE,
position = "center",
font_size = 12
)
```

### 3. Variants by tier

```{r, echo=FALSE}
library(ggplot2)
tier_counts <- annotated |> dplyr::count(tier)

ggplot(tier_counts, aes(x = tier, y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Variant counts by tier",
x = "Tier",
y = "Number of variants"
)
```

### 4. Single variant deep dive with a TP53 example

```{r, echo=FALSE}
example_display <- example %>%
select(
gene,
position,
ref,
alt,
mutation_classification,
mutation_status,
afr_frequency,
tier,
tier_explanation
)

example_display %>%
kable(
format = "html",
caption = "Single Variant Deep Dive – TP53 Example",
col.names = c(
"Gene",
"Position (GRCh38)",
"Ref",
"Alt",
"Clinical classification",
"Mutation status",
"AFR frequency",
"Tier",
"Tier explanation"
),
escape = TRUE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = FALSE,
position = "center",
font_size = 12
)
```
